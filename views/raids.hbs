<html>
<head>

<style>
	body{
    	background-image: url("/images/vacation.jpg");
    	background-size: cover;
		color: #DEE8E9;
		margin: 0px;
	}
	.root{
		margin: 0px;
		padding: 0px;
	}
	.header{
		display: flex;
		justify-content: space-between;
		margin-bottom: 10px;
	}
	.header .iconBox input[type="button"]{
		width: 150px;
		height: 100%;
		margin: 5px;
		background-color: #B8B5B0;
		border: 0px;
		color: #0A528C;
		font-weight: bold;
	}
	.timeTable{
		width: 98%;
		height: 90%;
		padding: 10px;
		display: flex;
    	flex-direction: row;
	    justify-content: flex-start;
		overflow-y: auto;
		overflow-x: scroll;
	}
	.timeTable::-webkit-scrollbar{
		background-color: transparent;
	}
	.timeTable::-webkit-scrollbar-thumb{
		background-color: white;
		border-radius: 10px;
	}
	.timeTable::-webkit-scrollbar-button{
		background-color: transparent;
	}
	.timeTable .row{
		display: flex;	
	    flex-direction: column;
		width: 350px;
		min-width: 350px;
		height: 100%;
	}
	.row .title{
		text-align: center;
	}
	.row .post{
		background-color: #0A528C;
		padding: 10px;
		margin: 5px;
		border: 1px solid black;
		border-radius: 10px;
	}
	.post .time{
		margin-bottom: 10px;
		
	}
	.post .users{
		margin-bottom: 10px;
	}
	.post .user{
		display: flex;
	}
	.post .role{
		margin-right: 5px;
		width: 97px;
	}
	.post input[type="button"]{
		width: 100%;
		height: 30px;
		background-color: #B8B5B0;
		color: #0A528C;
		border: 0px;
		font-weight: bold;
	}

</style>
</head>
<body>
<div id="root">
	<div class="header">
		<div class="title">
			<div id="nickName"> hello, {{mainCharacter}}.</div>
			<div id="time"></div>

		</div>
		<div class="iconBox">
			<input type="button" id="apply" value="새 글 등록하기">
		</div>

	</div>
	<div class="timeTable">
		<div class="row" id = "commander1">
			<div class="title"><h3>발탄_노말</h3></div>
			<div class="post">
				등록된 공격대가 없습니다.
			</div>
		</div>
		<div class="row" id = "commander2">
			<div class="title"><h3>발탄_하드</h3></div>
			<div class="post">
				등록된 공격대가 없습니다.
			</div>
		</div>
		<div class="row" id = "commander3">
			<div class="title"><h3>비아키스_노말</h3></div>
			<div class="post">
				등록된 공격대가 없습니다.
			</div>
		</div>
		<div class="row" id = "commander4">
			<div class="title"><h3>비아키스_하드</h3></div>
			<div class="post">
				등록된 공격대가 없습니다.
			</div>
		</div>
		<div class="row" id = "commander5">
			<div class="title"><h3>쿠크세이튼 리허설</h3></div>
			<div class="post">
				등록된 공격대가 없습니다.
			</div>
		</div>
		<div class="row" id = "commander6">
			<div class="title"><h3>쿠크세이튼</h3></div>
			<div class="post">
				등록된 공격대가 없습니다.
			</div>
		</div>
		<div class="row" id = "commander7">
			<div class="title"><h3>아브렐슈드_데자뷰</h3></div>
			<div class="post">
				등록된 공격대가 없습니다.
			</div>
		</div>
		<div class="row" id = "commander8">
			<div class="title"><h3>아브렐슈드_노말</h3></div>
			<div class="post">
				등록된 공격대가 없습니다.
			</div>
		</div>
		<div class="row" id = "commander9">
			<div class="title"><h3>아브렐슈드_하드</h3></div>
			<div class="post">
				등록된 공격대가 없습니다.
			</div>
		</div>

	</div>
	
</div>
<script>
	Date.prototype.format = function(f) {
	    if (!this.valueOf()) return " ";
	
	    var weekName = ["일요일", "월요일", "화요일", "수요일", "목요일", "금요일", "토요일"];
	    var d = this;
	
	    return f.replace(/(yyyy|yy|MM|dd|E|hh|mm|ss|a\/p)/gi, function($1) {
	        switch ($1) {
	            case "yyyy": return d.getFullYear();
	            case "yy": return (d.getFullYear() % 1000).zf(2);
	            case "MM": return (d.getMonth() + 1).zf(2);
	            case "dd": return d.getDate().zf(2);
	            case "E": return weekName[d.getDay()];
	            case "HH": return d.getHours().zf(2);
	            case "hh": return ((h = d.getHours() % 12) ? h : 12).zf(2);
	            case "mm": return d.getMinutes().zf(2);
	            case "ss": return d.getSeconds().zf(2);
	            case "a/p": return d.getHours() < 12 ? "오전" : "오후";
	            default: return $1;
	        }
	    });
	};
	
	String.prototype.string = function(len){var s = '', i = 0; while (i++ < len) { s += this; } return s;};
	String.prototype.zf = function(len){return "0".string(len - this.length) + this;};
	Number.prototype.zf = function(len){return this.toString().zf(len);};


	
	const connectedDate = new Date();
	const options = {
		"baltan": ["1", "2"],
		"biackiss": [ "1", "2", "3"],
		"koukuSaton": [ "1", "2", "3"],
		"abrelshudDejavu":["1-2", "3-4"],
		"abrelshud": ["1-2", "3-4", "5-6"]
	}
	document.querySelector("#apply").addEventListener("click", function(event){
		window.location.href = "/reservation"
	})
	document.querySelector("#time").innerText = `오늘은 ${connectedDate.getFullYear()}년 ${connectedDate.getMonth()+1}월 ${connectedDate.getDate()}일 입니다.`;

	const xhr = new XMLHttpRequest();
	xhr.onreadystatechange = function(){
		if(xhr.readyState === xhr.DONE){
			if(xhr.status === 200 || xhr.status === 201){
				{{!-- console.log(xhr.responseText); --}}
				const posts = JSON.parse(xhr.responseText);
				console.log(posts);
				posts.forEach((post)=>{
					const targetGates = post.target.split(",");
					let option;
					switch(post.commander){
						case "1":
						case "2":
							option = options.baltan;
							break;
						case "3":
						case "4":
							option = options.biackiss;
							break;
						case "5":
						case "6":
							option = options.koukuSaton;
							break;
						case "7":
							option = options.abrelshudDejavu;
							break;
						case "8":
						case "9":
							option = options.abrelshud;
							break;
						default:
							break;
					}
					let postHtml = `<div class="post">`
									+`	<div class="">출발 시간</div>`
									+`	<div class="time">${new Date(post.date).format("yyyy-MM-dd E a/p hh:mm")}</div>`
									+`	<div class="">도전 관문</div>`
									+`	<div class="time">${option[targetGates[0]]} - ${option[targetGates[1]]}</div>`
									+`	<div class="users">`
					post.applicants.forEach((applicant)=>{
						postHtml += `<div class="user">`
								   +`	<div class="role">${applicant.applicantClass}</div>`
								   +`	<div class="nickname">${applicant.applicantId}</div>`
								   +`</div>`
					})
					postHtml	   +=`	</div><input type="button" value="지원하기" onclick="window.location.href='/apply?post_id=${post.post_idx}'"></div>`
					const postElement = createElementFromHTML(postHtml);
					document.querySelector("#commander"+post.commander).appendChild(postElement);
				})

			}else{
				console.error(xhr.responseText);
			}
		}
	}
	xhr.open("GET", "api/posts");
	xhr.send();

	function createElementFromHTML(htmlString) {
	    let div = document.createElement("div");
	    div.innerHTML = htmlString.trim();

	    // Change this to div.childNodes to support multiple top-level nodes
	    return div.firstChild;
	}
</script>

</body>


</html>